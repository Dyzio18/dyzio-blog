---
title: Next.js cz.2 - Generowanie dynamicznych stron w Next.js 13 na podstawie plik贸w CSV (Server Side Rendering)
date: '2023-09-23'
tags: ['react', 'ssr', 'next.js', 'TypeScript', 'csv']
draft: false
summary: Stawiamy pierwsz stron internetow na Next.js 13 - SSR, pobieranie danych z pliku, generowanie dynamicznych stron na serwerze.
---

# Next.js - Pierwsza statyczna strona na Next.js i React

Przegldajc oferty pracy na frontend coraz czciej spotykam si z firmami kt贸re stawiaj swoje aplikacje na Next.js - co to takiego i jak tego u偶y? Postaram sie wyjanij w poni偶szym wpisie. 

Dla przykadu posu偶y nam strona kt贸r postawiem dla zabawy i nauki tj. https://2023wybory.pl 
Strona serwuje statyczne pliki HTML wraz z danymi z oficjalnej strony PKW (https://wybory.gov.pl/sejmsenat2023/pl/dane_w_arkuszach) w postaci plik贸w CSV.

## Next.js, co to jest? 

Next.js to framework JavaScript, oparty na React. Pozwala generowa statyczne strony na serwerze. Statyczne pliki HTML to oczywicie wiksza wydajno, szybko adowania strony i lepsze SEO. 
To wszystko byo ju偶 wczeniej ale Next.js czyni to po prostu wygodnym. 

W projekcie wykorzystaem wersj 13 - to ma znaczenie bo wersja ta wprowadza kilka istotnych zmian.
Najwa偶niejsz zmian kt贸ra bdzie rzutowa r贸wnie偶 na Twoim nowym projekcie Next.js jest wykorzystanie katalogu `app` zamiast `pages`. Niby niewielka zmiana a r贸偶nica w u偶yciu jest spora. Zmienia si routing oraz przekazywanie props'贸w dla dynamicznych stron.

Katalog `app` zosta wprowadzony w wersji 13, wicej o zmianach przeczytasz na [oficjalnej stronie Next.js](https://nextjs.org/blog/next-13). Stawiajc swoj pierwsz stron bazowaem na dokumentacji i r贸偶nych wpisach/poradnikach. Moje zdziwienie i frustracja byy coraz wiksze gdy kolejne proponowane rozwizania nie dziaay. Problem by ju偶 ciekawy bo chciaem generowa na podstawie pliku CSV, strony dla pojedynczych okrg贸w wyborczych `2023wybory.pl/sejm/{NrOkrgu}`. 


## Generowanie statycznych stron i dynamiczny routing

W poprzedniej architekturze opartej na `pages` 偶eby wygenerowa statyczne strony dla dynamicznych danych, na przykad: `products/{category}/{id}` u偶ywalimy dw贸ch metod:

* `getStaticProps` - pobranie danych dla statycznej strony, 
* `getStaticPaths` - generacja dynamicznych cie偶ek. 

Wiele odpowiedzi na stackoverflow oraz poradnik贸w opisuj stary spos贸b. Next.js 13 dalej umo偶liwia korzystanie z katalogu `pages` jednak preferowany jest `app`. Ma on wicej funkcjonalnoci i jest to domylny katalog kt贸ry przesoni routing `pages`. App jest zoptymalizowany i pozwala na wygenerowanie wikszoci kodu po stronie serwera. Nie zaleca sie stosowania obu katalog贸w, tworzc nowy projekt wybierz `app`. Miej to na uwadze gdy przegldasz blogi i dokumentacje. Dopiero wtek na stackoverflow uwiadomi mi 偶e s dwie wersje dokumentacji dla Next.js, a ja przez jaki czas u偶ywaem nie tej co trzeba, zonk .

Dla stron opartych na `app` powinnimy u偶y `generateStaticParams` 偶eby wygenerowa dynamiczny routing. Wczytujemy dane w dowolny spos贸b i przekazujemy do funkcji `generateStaticParams` kt贸ra zwraca list z props'ami dla ka偶dej ze stron. Pamitaj 偶e musimy eksportowa `generateStaticParams`. Zwracana lista jest iterowana po elementach, na podstawie tego generowane s statyczne strony gdzie do `export default function` przekazujemy parametry `params`.

W moim przypadku wczytywaem dane z lokalnego pliku CSV, na podstawie arkusza generowaem stron dla ka偶dego z okrg贸w wyborczych. Poni偶ej kod strony: 

```{JavaScript}
// file: app/districts/[id].tsx
import { getCsvDistrictIds, getSejmCsvDataByDistrict, getSejmCandidatesCsvDataByDistrict } from '@/lib/getCsvData';

interface PageProps {
  params: {
    id: number;
    data?: any;
  };
}

export async function generateStaticParams() {
  const paths = getCsvDistrictIds('sejm.csv');
  return paths.map((id) => {
    return {
      params: {
        id: id,
      },
    };
  });
}

export default function Page({ params }: PageProps) {
  const district = getSejmCsvDataByDistrict(params.id).region;
  const candidates = getSejmCandidatesCsvDataByDistrict(params.id).candidates;

  return (
    <div className='container mx-auto max-w-screen-xl px-4 pb-6 sm:px-6 lg:px-8'>
      <h1 className="text-2xl font-bold">Okrg: {params.id}</h1>
      {JSON.stringify(district)}
      {JSON.stringify(candidates)}
    </div>
  );
}
```
        
