---
title: Pierwszy projekt w Next.js 13. dynamiczne strony (SSR) generowane na serwerze z plik贸w CSV.
date: '2023-09-23'
tags: ['react', 'ssr', 'next.js', 'TypeScript', 'csv']
draft: false
summary: Next.js 13, projekt wybory2023.pl - pobieranie danych z pliku, generowanie dynamicznych stron na serwerze (SSR).
---

# Next.js - Pierwsza statyczna strona na Next.js a tak naprawd React ze sterydami.

## Wprowadzenie

Caa historia zaczyna si gdy w 2020 roku w czasie pandemii Covida w Polsce odbyy si wybory prezydenckie.
Myslaem o stworzeniu prostej viralowej gry strategicznej/klikanki osadzonej w polsko-polskiej rzeczywistoci politycznej.
To miao szans si uda i zaistnie na jakim viralowym medium typu MLH/Wykop a wtedy m贸gbym sprawdzi jak dziaa obci偶ony serwis i mie fun.
Okazao si 偶e domena wybory2023.pl jest wolna, kupiem j. Przypomniaem sobie jednak o planie gry zbyt p贸藕no bo we wrzeniu 2023 roku. Bez wikszych inspiracji co do detali i chci odpuciem ten projekt. Nie chciaem zostawi domeny po prostu pustej wiec minimalnym wysikiem wiedzc 偶e projekt jest skazany na pora偶k postanowiem umieci chocia偶 sonda偶e i wyniki wyborcze dla ratowania wasnych ambicji.

Przy okazji chciaem sprawdziem jak dziaa Next.js kt贸ry idealnie nadaje si do generowania i cachowania statycznych stron. 
Jak to si m贸wi, nie ma nic szybszego ni偶 statyczny HTML na Nginx :) a p贸藕niej tylko load-balancer i wincyj serwer贸w. 

Za 藕r贸do danych posu偶ya mi oficjalna strona PKW (https://wybory.gov.pl/sejmsenat2023/pl/dane_w_arkuszach) i arkusze z wynikami  w postaci plik贸w CSV. Arkusze byy wczytywane i przerabiane na stron www kt贸ra renderowaa si na serwerze. Zrobienie samej strony zajeo mi kilka-kilkanacie godzin. Poni偶ej linki do projektu:

- Podgld: (https://2023wybory-pl-git-main-dyzio18.vercel.app/)
- Repozytorium: (https://github.com/Dyzio18/2023wybory.pl/tree/main) 

## Next.js, co to jest? 

Next.js to framework JavaScript, oparty na React. Pozwala generowa statyczne strony na serwerze. Statyczne pliki HTML to oczywicie wiksza wydajno, szybko adowania strony i lepsze SEO. 
To wszystko byo ju偶 wczeniej ale Next.js czyni to po prostu wygodnym. 

W projekcie wykorzystaem wersj 13 - to ma znaczenie bo wersja ta wprowadza kilka istotnych zmian.
Najwa偶niejsz zmian kt贸ra bdzie rzutowa r贸wnie偶 na Twoim nowym projekcie Next.js jest wykorzystanie katalogu `app` zamiast `pages`. Niby niewielka zmiana a r贸偶nica w u偶yciu jest spora. Zmienia si routing oraz przekazywanie props'贸w dla dynamicznych stron.

Katalog `app` zosta wprowadzony w wersji 13, wicej o zmianach przeczytasz na [oficjalnej stronie Next.js](https://nextjs.org/blog/next-13). Stawiajc swoj pierwsz stron bazowaem na dokumentacji i r贸偶nych wpisach/poradnikach. Moje zdziwienie i frustracja byy coraz wiksze gdy kolejne proponowane rozwizania nie dziaay. Problem by ju偶 ciekawy bo chciaem generowa na podstawie pliku CSV, strony dla pojedynczych okrg贸w wyborczych `2023wybory.pl/sejm/{NrOkrgu}`. 


## Generowanie statycznych stron i dynamiczny routing

W poprzedniej architekturze opartej na `pages` 偶eby wygenerowa statyczne strony dla dynamicznych danych, na przykad: `products/{category}/{id}` u偶ywalimy dw贸ch metod:

* `getStaticProps` - pobranie danych dla statycznej strony, 
* `getStaticPaths` - generacja dynamicznych cie偶ek. 

Wiele odpowiedzi na stackoverflow oraz poradnik贸w opisuj stary spos贸b. Next.js 13 dalej umo偶liwia korzystanie z katalogu `pages` jednak preferowany jest `app`. Ma on wicej funkcjonalnoci i jest to domylny katalog kt贸ry przesoni routing `pages`. App jest zoptymalizowany i pozwala na wygenerowanie wikszoci kodu po stronie serwera. Nie zaleca sie stosowania obu katalog贸w, tworzc nowy projekt wybierz `app`. Miej to na uwadze gdy przegldasz blogi i dokumentacje. Dopiero wtek na stackoverflow uwiadomi mi 偶e s dwie wersje dokumentacji dla Next.js, a ja przez jaki czas u偶ywaem nie tej co trzeba, zonk .

Dla stron opartych na `app` powinnimy u偶y `generateStaticParams` 偶eby wygenerowa dynamiczny routing. Wczytujemy dane w dowolny spos贸b i przekazujemy do funkcji `generateStaticParams` kt贸ra zwraca list z props'ami dla ka偶dej ze stron. Pamitaj 偶e musimy eksportowa `generateStaticParams`. Zwracana lista jest iterowana po elementach, na podstawie tego generowane s statyczne strony gdzie do `export default function` przekazujemy parametry `params`.

W moim przypadku wczytywaem dane z lokalnego pliku CSV, na podstawie arkusza generowaem stron dla ka偶dego z okrg贸w wyborczych. Poni偶ej kod strony: 

```{JavaScript}
// file: app/districts/[id].tsx
import { getCsvDistrictIds, getSejmCsvDataByDistrict, getSejmCandidatesCsvDataByDistrict } from '@/lib/getCsvData';

interface PageProps {
  params: {
    id: number;
    data?: any;
  };
}

export async function generateStaticParams() {
  const paths = getCsvDistrictIds('sejm.csv');
  return paths.map((id) => {
    return {
      params: {
        id: id,
      },
    };
  });
}

export default function Page({ params }: PageProps) {
  const district = getSejmCsvDataByDistrict(params.id).region;
  const candidates = getSejmCandidatesCsvDataByDistrict(params.id).candidates;

  return (
    <div className='container mx-auto max-w-screen-xl px-4 pb-6 sm:px-6 lg:px-8'>
      <h1 className="text-2xl font-bold">Okrg: {params.id}</h1>
      {JSON.stringify(district)}
      {JSON.stringify(candidates)}
    </div>
  );
}
```
        
Jeli Ci zainteresowaem mo偶esz zajrze do repozytorium i na oficjaln stron Next.js.
Projekt bardzo zyskuje na popularnoci i wydaj si istotnym rozszerzeniem dla ekosystemu React. 
Jest to doby wyb贸r szczeg贸lnie dla du偶ych serwis贸w, blog贸w, i stron kt贸re mocno stawiaj na SEO i wydajno. 
Next.js ma solidny trend wzrostowy i nic nie zapowiada 偶eby by mniej popularny. Osobicie jestem bardzo zadowolony, uwa偶am 偶e w kocu powstao dobre rozwizanie dla obsugi React na serwerze. Jest to bardzo kompleksowe rozwizanie zaakceptowane przez community z du偶ym wsparciem innych rozwiza/tw贸rc贸w. 